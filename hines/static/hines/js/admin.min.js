!function(e){"use strict";e(document).ready(function(){hines.admin.markdownEditor().init()}),window.hines=window.hines||{},window.hines.admin=window.hines.admin||{},window.hines.admin.markdownEditor=function(){function t(e){!function(e,t,i){if(/editor-preview-active/.test(e.codemirror.getWrapperElement().lastChild.className))return;i=void 0===i?t:i;var n,a=e.codemirror,o=(e.getState(a),t),l=i,r=a.getCursor("start"),c=a.getCursor("end");n=a.getSelection(),n=n.split(t).join(""),n=n.split(i).join(""),a.replaceSelection(o+n+l),r.ch+=t.length,c.ch=r.ch+n.length,a.setSelection(r,c),a.focus()}(e,"<cite>","</cite>")}function i(e,t){var i='<figure class="figure figure--img';["left","right","full"].indexOf(t)>-1&&(i+=" figure--"+t);a(e,i+='">\n  <img src="','" alt="">\n  <figcaption></figcaption>\n</figure>')}function n(e,t){var i='<figure class="figure figure--embed';["left","right"].indexOf(t)>-1&&(i+=" figure--"+t),i+='">\n  <div class="figure--embed__16by9">\n    <iframe src="';var n=e.codemirror.getSelection();if(n.startsWith("http")){!function(e,t){var i=e.codemirror,n={},a={};Object.assign(n,i.getCursor("start")),Object.assign(a,i.getCursor("end"));var o=i.getSelection();i.replaceSelection(t),a.ch+=t.length-o.length,i.setSelection(n,a),i.focus()}(e,function(e){if(e.search(/youtube.com\/watch/)>=0){var t=new URL(e.trim()),i=t.searchParams.get("v"),n=t.searchParams.get("t");i&&(e="https://www.youtube.com/embed/"+i,n&&(e+="?start="+n))}else if(e.search(/\/\/vimeo.com/)>=0){var a=e.match(/vimeo.com\/(\w+)$/);a.length>1&&(e="https://player.vimeo.com/video/"+a[1])}return e}(n))}a(e,i,'" allowfullscreen></iframe>\n    <figcaption></figcaption>\n  </div>\n</figure>')}function a(e,t,i){var n=e.codemirror,a=n.getCursor("start"),o=n.getCursor("end"),l=a.line+1,r=o.line+1,c=a.line!==o.line,s=t,f=i;c&&r++,c&&0===o.ch&&(f=i+"\n",r--),function(e,t,i,n){if(/editor-preview-active/.test(e.getWrapperElement().lastChild.className))return;var a,o=i[0],l=i[1],r={},c={};Object.assign(r,e.getCursor("start")),Object.assign(c,e.getCursor("end")),n&&(l=l.replace("#url#",n));t?(a=e.getLine(r.line),o=a.slice(0,r.ch),l=a.slice(r.ch),e.replaceRange(o+l,{line:r.line,ch:0})):(a=e.getSelection(),e.replaceSelection(o+a+l),r.ch+=o.length,r!==c&&(c.ch+=o.length));e.setSelection(r,c),e.focus()}(n,!1,[s,f]),n.setSelection({line:l,ch:0},{line:r,ch:0})}var o=[{selector:"body.app-weblogs.model-post.change-form #id_intro",elementId:"id_intro",autosaveId:"weblogs-post-intro",buttons:"minimal",minHeight:"100px"},{selector:"body.app-weblogs.model-post.change-form #id_body",elementId:"id_body",autosaveId:"weblogs-post-body",buttons:"full",minHeight:"300px"}];return{init:function(){"2"==e("#id_html_format").val()&&e.each(o,function(o,l){e(l.selector).length>0&&function(e){var o={element:document.getElementById(e.elementId),autoDownloadFontAwesome:!0,autosave:{enabled:!0,uniqueId:function(e){var t=e.autosaveId,i=function(){var e=window.location.href.split("/"),t=e.length;return"change"==e[t-2]?e[t-3]:null}();return null!==i&&(t+="-"+i),t}(e),delay:12e4},indentWithTabs:!1,promptURLs:!0,minHeight:e.minHeight};"minimal"==e.buttons?o.toolbar=["bold","italic",{name:"cite",action:t,className:"fa fa-angle-double-left",title:"Cite"},"link","|","preview","side-by-side","fullscreen"]:"full"==e.buttons&&(o.toolbar=["bold","italic",{name:"cite",action:t,className:"fa fa-angle-double-left",title:"Cite"},"link","|","heading","code",{name:"quote-with-caption",action:function(e){a(e,'<figure class="figure figure--blockquote">\n  <blockquote>\n    <p>',"    </p>\n  </blockquote>\n  <figcaption></figcaption>\n</figure>")},className:"fa fa-quote-left",title:"Quote with caption"},"|",{name:"image-left",action:function(e){i(e,"left")},className:"fa fa-arrow-left",title:"Image, aligned left"},{name:"image-standard",action:function(e){i(e,"standard")},className:"fa fa-picture-o",title:"Image, standard"},{name:"image-full",action:function(e){i(e,"full")},className:"fa fa-arrows-h",title:"Image, full-width"},{name:"image-right",action:function(e){i(e,"right")},className:"fa fa-arrow-right",title:"Image, aligned right"},"|",{name:"video-left",action:function(e){n(e,"left")},className:"fa fa-backward",title:"Video, aligned left"},{name:"video-full",action:function(e){n(e,"full")},className:"fa fa-play",title:"Video, full-width"},{name:"video-right",action:function(e){n(e,"right")},className:"fa fa-forward",title:"Video, aligned right"},"|","preview","side-by-side","fullscreen"]),new EasyMDE(o)}(l)})}}}}(django.jQuery);