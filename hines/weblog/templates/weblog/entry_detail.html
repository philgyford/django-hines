{% extends "base_weblog.html" %}

{% block relnav %}
    {% if entry.get_previous_published %}
        <link rel="prev bookmark" href="{{ entry.get_previous_published.get_absolute_url }}" title="{{ entry.get_previous_published.title }}" />
    {% endif %}
    {% if entry.get_next_published %}
        <link rel="next bookmark" href="{{ entry.get_next_published.get_absolute_url }}" title="{{ entry.get_next_published.title }}" />
    {% endif %}
{% endblock relnav %}

{% block title %}{{ entry.title }}{% endblock %}

{% block content_title %}{{ entry.title }}{% endblock %}


{% block content %}

    {{ entry.body_html|safe }}

    {% if entry.body_more_html %}
        {{ entry.body_more_html|safe }}
    {% endif %}

    {% load comments %}
    {% load markup %}
    
    {% get_comment_list for entry as comment_list %}
    
    {% if comment_list %}
        <h2>{% if entry.num_comments == 0 %}Comment{% else %}{{ entry.num_comments }} comment{{ entry.num_comments|pluralize }}{% endif %}</h2>
        <div id="comments">
        {% for comment in comment_list %}
            <div id="c{{ comment.id }}">
                <p>On {{ comment.submit_date|date:date_format_short }} <a href="{{ comment.content_object.get_absolute_url }}#c{{ comment.id }}">{{ comment.submit_date|date:time_format }}</a> {% if comment.url %}<a href="{{ comment.url }}">{{ comment.name }}</a>{% else %}{{ comment.name }}{% endif %} said:</p>
        
                {{ comment.comment|markdown:"safe" }}
            </div>
        {% endfor %}
        </div>
    {% endif %}
    
        <h2>{% if comment_list %}Add a comment{% else %}Be first to comment{% endif %}</h2>
        {% render_comment_form for entry %}

{% endblock content %}


{% block sidebar %}
    <div class="block">
        <p>
            {% if entry.get_previous_published %}
                <a href="{{ entry.get_previous_published.get_absolute_url }}" title="{{ entry.get_previous_published.title }}">&larr; Older</a>
            {% else %}
                &larr; Older
            {% endif %}
            |
            {% if entry.get_next_published %}
                <a href="{{ entry.get_next_published.get_absolute_url }}" title="{{ entry.get_next_published.title }}">Newer &rarr;</a>
            {% else %}
                Newer &rarr;
            {% endif %}
        </p>
        <p>{{ entry.published_date|date:time_format }} {{ entry.published_date|date:date_format_long }}</p>
    </div>
    {% for other_blog in other_blogs %}
        {% if other_blog.entries %}
            <div class="block">
            {% load aggregator_tags %}
            <h2>{{ other_blog.short_name }} for {% linked_date entry.published_date date_format_short_strf %}</h2>

            {% for entry in other_blog.entries reversed %}
                {% include 'includes/entry_sidebar.html' %}
            {% endfor %}
            </div>
        {% endif %}
    {% endfor %}
{% endblock sidebar %}