{% extends 'stats/base.html' %}

{% block content %}

  {% for chart in charts %}
    {% with chart.name|cut:"_" as header_id %}
      <h2 id="{{ header_id }}">{{ chart.title }}</h2>
    {% endwith %}

    <div class="chart js-chart-{{ chart.name }}"></div>

    {% if chart.description %}
      <p class="chart-description">{{ chart.description|safe }}</p>
    {% endif %}
  {% endfor %}

{% endblock content %}


{% block body_extra %}

  {{ block.super }}

  {# Outputs the chart data as JSON in <script> tags with the ID of chart.name #}
  {% for chart in charts %}
    {{ chart.data|json_script:chart.name }}
  {% endfor %}

  <script>
    domready(function() {

      var data;
      var chart;

      {% for chart in charts %}
        data = JSON.parse(document.getElementById('{{ chart.name}}').textContent);

        chart = hines.chart().kind('bar');

        d3.select('.js-chart-{{ chart.name }}').datum(data).call(chart);
      {% endfor %}

    });
  </script>

{% endblock body_extra %}
