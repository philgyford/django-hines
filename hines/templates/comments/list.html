{% load hines_comments hines_core %}
{% load l10n %}

{% if post.comment_count > 0 %}
  <section>
    <h2>
      {{ post.comment_count }} comment{{ post.comment_count|pluralize }}
    </h2>

    <ol class="media-list">
      {% for comment in comment_list %}
        <li class="media h-entry" id="c{{ comment.id|unlocalize }}">
          <div class="media__body">
            <p class="media__byline"{% if forloop.last %} id="latest"{% endif %}>
              <span class="media__byline__author h-card">
                {% if comment.user_url %}
                  <a class="p-name u-url" href="{{ comment.user_url }}" rel="nofollow">{{ comment.name }}</a>
                {% else %}
                  <span class="p-name">{{ comment.name }}</span>
                {% endif %}
              </span>

              at <span class="dt-published">{% display_time comment.submit_date %}</span>
              &nbsp;
              <a class="section-anchor" href="#c{{ comment.id|unlocalize }}" title="Link to this comment">#</a>
              {% if perms.custom_comments.can_change_customcomment %}
                &nbsp; <a class="u-admin u-url" href="{% url 'admin:custom_comments_customcomment_change' comment.id %}" title="Edit this Comment in the Django Admin">Edit</a>
              {% endif %}
            </p>

            <div class="e-content">
              {{ comment.comment|clean|safe|linebreaks }}
            </div>

          </div> <!-- .media__body -->
        </li>
      {% endfor %}
    </ol>

    {# If the user posted a comment that was flagged as Spam, then a message will have been set, with extra_tags="spam", so: #}
    {% if messages %}
      {% for message in messages %}
        {% if "spam" in message.tags %}
          <p class="u-warning{% if message.tags %} {{ message.tags }}{% endif %}">
            {{ message|safe }}
          </p>
        {% endif %}
      {% endfor %}
    {% endif %}

  </section>
{% endif %}
