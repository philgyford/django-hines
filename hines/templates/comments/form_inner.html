{# Included by form.html and preview.html #}

{% load i18n %}

{% if next %}<input type="hidden" name="next" value="{{ next }}" />{% endif %}

{% for field in form %}
    {% if field.is_hidden %}
        {{ field }}
    {% else %}
        {% if field.errors %}{{ field.errors }}{% endif %}
        
        {% if not user.is_authenticated %}
            {# Standard form template stuff #}
            <p
            {% if field.errors %} class="error"{% endif %}
            {% ifequal field.name "honeypot" %} style="display:none;"{% endifequal %}>
            {{ field.label_tag }} {{ field }}
            </p>
        {% else %}
            {# Logged-in user #}
            {% if field.name == 'name' or field.name == 'email' %}
                {% if field.name == 'name' %}
                    <p>{% if user.get_full_name %}{{ user.get_full_name }}{% else %}{{ user.username }}{% endif %} &lt;{{ user.email }}&gt;</p>
                {% endif %}
                <input type="hidden" name="{{ field.html_name }}" id="id_{{ field.html_name }}" value="{% if field.name == 'name' %}{% if user.get_full_name %}{{ user.get_full_name }}{% else %}{{ user.username }}{% endif %}{% else %}{{ user.email }}{% endif %}">
            {% else %}
                {# Standard form template stuff, duplicated from above #}
                <p
                  {% if field.errors %} class="error"{% endif %}
                  {% ifequal field.name "honeypot" %} style="display:none;"{% endifequal %}>
                  {{ field.label_tag }} {{ field }}
                </p>
            {% endif %}
        {% endif %}
     {% endif %}
{% endfor %}
<p class="submit">
    <input type="submit" name="post" class="submit-post" value="{% trans "Post" %}" />
    <input type="submit" name="preview" class="submit-preview" value="{% trans "Preview" %}" />
</p>