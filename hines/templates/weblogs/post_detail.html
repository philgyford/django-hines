{% extends 'hines_core/layouts/no_sidebar.html' %}
{% load comments hines_core hines_weblogs spectator_reading %}

{% block head_page_title %}{{ post.title|smartypants|safe }}{% endblock %}

{# We put the heading within <article> #}
{% block content_heading %}{% endblock content_heading %}

{% block head_extra %}
	{{ block.super }}
	<link rel="index" title="In all of {{ post.blog.short_name }}" href="{% url 'hines:blog_archive' blog_slug=post.blog.slug %}"/>
	{% with post.get_previous_post as previous_post %}
		{% if previous_post %}
			<link rel="prev" title="{{ previous_post.get_absolute_url }}" href="{{ previous_post.title }}"/>
		{% endif %}
	{% endwith %}
	{% with post.get_next_post as next_post %}
		{% if next_post %}
			<link rel="next" title="{{ next_post.get_absolute_url }}" href="{{ next_post.title }}"/>
		{% endif %}
	{% endwith %}
{% endblock %}

{% block content %}

  <article class="article">
    <div class="pagehead">
      <header>
        <h1>{{ post.title|smartypants|safe }}</h1>
      </header>
    </div>

    {% if is_preview %}
      <p class="admin">
        This is a preview. This Postâ€™s status is {{ post.status_str }}.
      </p>
    {% endif %}

    {% if perms.weblogs.can_change_post %}
      <p><a class="admin" href="{% url 'admin:weblogs_post_change' post.id %}" title="Edit this Post in the Django Admin">Edit</a></p>
    {% endif %}

		<div class="article__intro">
			{{ post.intro_html|safe }}
		</div>

    <aside class="article__aside">
      <div class="article__aside__inner">
      <p>{% display_time post.time_published link_to_day=True %}</p>

      {% with post.get_tags as tags %}
        {% if tags|length > 0 %}
          <div class="tags tags--inline">
            {% spaceless %}
              <h2 class="tags__heading">Tags:</h2>
              <ul class="tags__list">
                  {% for tag in tags %}
                    <li class="tag">
                      <a href="{% url 'hines:blog_tag_detail' blog_slug=post.blog.slug tag_slug=tag.slug %}" title="More posts tagged with {{ tag.name }}">{{ tag.name }}</a>
                    </li>
                  {% endfor %}
                </ul>
              {% endspaceless %}
          </div>
        {% endif %}
      {% endwith %}

      {% with post.get_previous_post as previous_post %}
        {% with post.get_next_post as next_post %}
          {% if previous_post or next_post %}
            <nav class="nextprev">
              <ul class="list--inline">
                {% spaceless %}
                  {% if previous_post %}
                    <li class="list--inline__item nextprev__prev">
                      <a href="{{ previous_post.get_absolute_url }}" title="{{ previous_post.title }}">&larr; <span class="a__inner">Older</span></a>
                    </li>
                  {% endif %}
                  {% if next_post %}
                    <li class="list--inline__item nextprev__next{% if previous_post %} nextprev__next--hasprev{% endif %}">
                      <a href="{{ next_post.get_absolute_url }}" title="{{ next_post.title }}"><span class="a__inner">Newer</span> &rarr;</a>
                    </li>
                  {% endif %}
                {% endspaceless %}
              </ul>
            </nav>
          {% endif %}
        {% endwith %}
      {% endwith %}
      </div>
    </aside>

		<div class="article__body">
			{{ post.body_html|safe }}
		</div>
  </article>

  <hr>

	{% render_comment_list for post %}

	{% if post.comments_allowed %}
		<h2>Post a comment</h2>
		{% render_comment_form for post %}
	{% else %}
		<p>Comments are closed for this post.</p>
	{% endif %}

	{% if post.trackback_count > 0 %}
		<section class="trackbacks">
			<h2>
				{{ post.trackback_count }} trackback{{ post.trackback_count|pluralize }}
			</h2>
			<hr>

			{% for trackback in post.get_visible_trackbacks %}
				<div class="row trackback" id="t{{ trackback.id }}">
					<div class="col-sm-3">
						<strong>
							{{ trackback.blog_name }}
						</strong>
						<br>
						{% display_time trackback.time_created %}
					</div>
					<div class="col-sm-9">
						<strong>
							<a href="{{ trackback.url }}" rel="nofollow">
								{{ trackback.title }}
							</a>
						</strong>
						<p>{{ trackback.excerpt }}</p>
					</div>
				</div> <!-- .trackback -->
				<hr>
			{% endfor %}
		</section>
	{% endif %}

{% endblock %}

